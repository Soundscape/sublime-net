(function(){var n;n=require("../"),describe("Broker test suite",function(){var e;return e=function(){return new n.Broker("ws://127.0.0.1:8080/ws","realm1")},it("should construct an instance",function(){var n;return n=e(),expect(n).not.toBeNull()}),it("should be able to connect and disconnect",function(n){var t;return t=e(),expect(t).not.toBeNull(),t.on("connected",function(){return expect(t.state()).toBe("connected"),t.disconnect(),n()}),t.connect()}),describe("Broker functionality test suite",function(){var n,t;return n=null,t=function(){},beforeEach(function(){return n=e()}),afterEach(function(){return n=null}),it("should be able to subscribe",function(e){return n.on("connected",function(){return n.subscribe("test",t).then(function(){return expect(n.channels.test).not.toBeNull(),n.disconnect()})}),n.on("disconnected",function(){return e()}),n.connect()}),it("should be able to unsubscribe",function(e){return n.on("connected",function(){return n.subscribe("test",t).then(function(){return expect(n.channels.test).not.toBeNull(),n.unsubscribe("test",t).then(function(){return expect(n.channels.test).toBeNull(),n.disconnect()})})}),n.on("disconnected",function(){return e()}),n.connect()}),it("should be able to publish",function(e){var t;return t=function(e){return n.disconnect()},n.on("connected",function(){return n.subscribe("com.example.test",t).then(function(){expect(n.channels["com.example.test"]).not.toBeNull(),n.publish("com.example.test",{hello:"world"},{exclude_me:!1})})}),n.on("disconnected",function(){return e()}),n.connect()}),it("should be able to register",function(e){var t,c;return c="com.example.register",t=function(n,e){return n+e},n.on("connected",function(){return n.register(c,t).then(function(){return expect(n.session.registrations.length).toBe(1),n.disconnect()})}),n.on("disconnected",function(){return e()}),n.connect()}),it("should be able to unregister",function(e){var t,c;return c="com.example.unregister",t=function(n,e){return n+e},n.on("connected",function(){return n.register(c,t).then(function(){return expect(n.session.registrations.length).toBe(1),n.unregister(c).then(function(){return expect(n.session.registrations.length).toBe(0),n.disconnect()})})}),n.on("disconnected",function(){return e()}),n.connect()}),it("should be able to call",function(e){var t,c;return c="com.example.call",t=function(n){return n[0]+n[1]},n.on("connected",function(){return n.register(c,t).then(function(){return expect(n.session.registrations.length).toBe(1),n.call(c,[10,20]).then(function(e){return expect(e).toBe(30),n.unregister(c).then(function(){return expect(n.session.registrations.length).toBe(0),n.disconnect()})})})}),n.on("disconnected",function(){return e()}),n.connect()})})})}).call(this);
